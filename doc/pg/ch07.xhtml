<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><title>Chapter 7. Archives</title><link href="../at4j_doc-1.1.css" type="text/css" rel="stylesheet" /><meta content="DocBook XSL Stylesheets V1.77.1" name="generator" /><link rel="home" href="index.xhtml" title="At4J Programmer's Guide" /><link rel="up" href="index.xhtml" title="At4J Programmer's Guide" /><link rel="prev" href="ch06.xhtml" title="Chapter 6. LZMA compression" /><link rel="next" href="ch08.xhtml" title="Chapter 8. Tar" /></head><body><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">Chapter 7. Archives</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ch06.xhtml">Prev</a> </td><th align="center" width="60%"> </th><td align="right" width="20%"> <a accesskey="n" href="ch08.xhtml">Next</a></td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap_archives" />Chapter 7. Archives</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="ch07.xhtml#reading_archives">Reading archives</a></span></dt><dt><span class="section"><a href="ch07.xhtml#extracting_from_archives">Extracting entries</a></span></dt><dt><span class="section"><a href="ch07.xhtml#creating_archives">Creating archives</a></span></dt><dd><dl><dt><span class="section"><a href="ch07.xhtml#entry_metadata">Determining the metadata for an entry</a></span></dt></dl></dd></dl></div><p>An <span class="emphasis"><em>archive</em></span> is a collection of files and directories, 
stored as archive <span class="emphasis"><em>entries</em></span> in a single file. The archive often also
stores some kind of metadata for each entry, such as its owner or its latest modification
time.</p><p>At4J supports reading and creating Zip and Tar archives.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reading_archives" />Reading archives</h2></div></div></div><p>A program can access files and directories in an archive by creating an <a class="apilink" title="org.at4j.archive.Archive" href="../api/index.html?org/at4j/archive/Archive.html">Archive</a> object, such as
<a class="apilink" title="org.at4j.zip.ZipFile" href="../api/index.html?org/at4j/zip/ZipFile.html">ZipFile</a> or <a class="apilink" title="org.at4j.tar.TarFile" href="../api/index.html?org/at4j/tar/TarFile.html">TarFile</a> on the archive file. The archive
contains a set of <a class="apilink" title="org.at4j.archive.ArchiveEntry" href="../api/index.html?org/at4j/archive/ArchiveEntry.html">ArchiveEntry</a>:s containing data on each 
archive entry, each with its unique <a class="apilink" title="org.entityfs.el.AbsoluteLocation" href="http://entityfs.sourceforge.net/releases/current/api/index.html?org/entityfs/el/AbsoluteLocation.html">AbsoluteLocation</a> in the
archive. Entries may be <a class="apilink" title="org.at4j.archive.ArchiveFileEntry" href="../api/index.html?org/at4j/archive/ArchiveFileEntry.html">ArchiveFileEntry</a>:s,
<a class="apilink" title="org.at4j.archive.ArchiveDirectoryEntry" href="../api/index.html?org/at4j/archive/ArchiveDirectoryEntry.html">ArchiveDirectoryEntry</a>:s or
<a class="apilink" title="org.at4j.archive.ArchiveSymbolicLinkEntry" href="../api/index.html?org/at4j/archive/ArchiveSymbolicLinkEntry.html">ArchiveSymbolicLinkEntry</a>:s. An <a class="apilink" title="org.at4j.archive.ArchiveFileEntry" href="../api/index.html?org/at4j/archive/ArchiveFileEntry.html">ArchiveFileEntry</a>
is a <a class="apilink" title="org.entityfs.ReadableFile" href="http://entityfs.sourceforge.net/releases/current/api/index.html?org/entityfs/ReadableFile.html">ReadableFile</a>, and an <a class="apilink" title="org.at4j.archive.ArchiveDirectoryEntry" href="../api/index.html?org/at4j/archive/ArchiveDirectoryEntry.html">ArchiveDirectoryEntry</a>
has a map of child entries with their names as keys. <a class="apilink" title="org.at4j.archive.Archive" href="../api/index.html?org/at4j/archive/Archive.html">Archive</a>
objects implement
<a class="apilink" title="java.io.Map" href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/io/Map.html">Map</a>&lt;<a class="apilink" title="org.entityfs.el.AbsoluteLocation" href="http://entityfs.sourceforge.net/releases/current/api/index.html?org/entityfs/el/AbsoluteLocation.html">AbsoluteLocation</a>, <a class="apilink" title="org.at4j.archive.ArchiveEntry" href="../api/index.html?org/at4j/archive/ArchiveEntry.html">ArchiveEntry</a>&gt;,
(read only) which makes it easy to access individual entries.</p><p>Entries in Zip and Tar archives
differ in what kind of metadata they store, so each archive format has its own
<a class="apilink" title="org.at4j.archive.ArchiveEntry" href="../api/index.html?org/at4j/archive/ArchiveEntry.html">ArchiveEntry</a> implementations. See <a class="xref" href="ch08.xhtml" title="Chapter 8. Tar">Chapter 8, <em>Tar</em></a>
and <a class="xref" href="ch09.xhtml" title="Chapter 9. Zip">Chapter 9, <em>Zip</em></a> for examples.</p><p>Since an <a class="apilink" title="org.at4j.archive.Archive" href="../api/index.html?org/at4j/archive/Archive.html">Archive</a> object keeps the backing archive file
open, it must be closed when the program is done using it.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extracting_from_archives" />Extracting entries</h2></div></div></div><p>Entries can be extracted and copied to a <a class="apilink" title="org.entityfs.FileSystem" href="http://entityfs.sourceforge.net/releases/current/api/index.html?org/entityfs/FileSystem.html">FileSystem</a> by
manually traversing through the entries in an <a class="apilink" title="org.at4j.archive.Archive" href="../api/index.html?org/at4j/archive/Archive.html">Archive</a> object or
by using the <a class="apilink" title="org.at4j.util.archive.ArchiveExtractor" href="../api/index.html?org/at4j/util/archive/ArchiveExtractor.html">ArchiveExtractor</a>.

</p><div class="example"><a id="ex_archive_extractor" /><p class="title"><strong>Example 7.1. Extracting files from a Zip file using the archive extractor</strong></p><div class="example-contents"><pre class="programlisting">// Extract all entries from the Zip file f to the directory d

<a class="apilink" title="org.at4j.zip.ZipFile" href="../api/index.html?org/at4j/zip/ZipFile.html">ZipFile</a> zf = new <a class="apilink" title="org.at4j.zip.ZipFile" href="../api/index.html?org/at4j/zip/ZipFile.html">ZipFile</a>(f);
try
{
  // Extract to d
  new <a class="apilink" title="org.at4j.util.archive.ArchiveExtractor" href="../api/index.html?org/at4j/util/archive/ArchiveExtractor.html">ArchiveExtractor</a>(zf).extract(d);
}
finally
{
  // Close the Zip file to release all its resources
  zf.close();
}</pre></div></div><p><br class="example-break" /></p><p>The <a class="apilink" title="org.at4j.util.archive.ArchiveExtractor" href="../api/index.html?org/at4j/util/archive/ArchiveExtractor.html">ArchiveExtractor</a>'s extraction process can be
fine-tuned by giving it a custom <a class="apilink" title="org.at4j.util.archive.ExtractSpecification" href="../api/index.html?org/at4j/util/archive/ExtractSpecification.html">ExtractSpecification</a>
object.</p><p>For some archive formats (Tar), there are customized archive extractors
(<a class="apilink" title="org.at4j.tar.TarExtractor" href="../api/index.html?org/at4j/tar/TarExtractor.html">TarExtractor</a>) that may be faster than the
<a class="apilink" title="org.at4j.util.archive.ArchiveExtractor" href="../api/index.html?org/at4j/util/archive/ArchiveExtractor.html">ArchiveExtractor</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="creating_archives" />Creating archives</h2></div></div></div><p>An archive file is created by creating a new archive format-specific
<a class="apilink" title="org.at4j.archive.builder.ArchiveBuilder" href="../api/index.html?org/at4j/archive/builder/ArchiveBuilder.html">ArchiveBuilder</a> object, for instance a <a class="apilink" title="org.at4j.zip.builder.ZipBuilder" href="../api/index.html?org/at4j/zip/builder/ZipBuilder.html">ZipBuilder</a>,
and then adding entries to it. See the following chapters for examples.</p><p>An archive builder may or may not be a <a class="apilink" title="org.at4j.archive.builder.StreamAddCapableArchiveBuilder" href="../api/index.html?org/at4j/archive/builder/StreamAddCapableArchiveBuilder.html">StreamAddCapableArchiveBuilder</a>.
A stream add capable builder has methods for adding data read from an input stream
as a file entry in the archive.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="entry_metadata" />Determining the metadata for an entry</h3></div></div></div><p>The metadata added to each entry is determined by its effective
<a class="apilink" title="org.at4j.archive.builder.ArchiveEntrySettings" href="../api/index.html?org/at4j/archive/builder/ArchiveEntrySettings.html">ArchiveEntrySettings</a> object
(<a class="apilink" title="org.at4j.zip.builder.ZipEntrySettings" href="../api/index.html?org/at4j/zip/builder/ZipEntrySettings.html">ZipEntrySettings</a>, <a class="apilink" title="org.at4j.tar.builder.TarEntrySettings" href="../api/index.html?org/at4j/tar/builder/TarEntrySettings.html">TarEntrySettings</a>, etc). Entry
settings can be defined in three different scopes:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Settings from <span class="emphasis"><em>rules</em></span> specified for a single add operation (highest
precedence). A rule is a settings object paired with a
<a class="apilink" title="org.entityfs.support.Filter" href="http://entityfs.sourceforge.net/releases/current/api/index.html?org/entityfs/support/Filter.html">Filter</a>&lt;<a class="apilink" title="org.at4j.archive.builder.EntryToArchive" href="../api/index.html?org/at4j/archive/builder/EntryToArchive.html">EntryToArchive</a>&gt;
(<a class="apilink" title="org.at4j.archive.builder.EntityToArchiveFilter" href="../api/index.html?org/at4j/archive/builder/EntityToArchiveFilter.html">EntityToArchiveFilter</a>) filter to determine which
entries it should be applied to.</li><li class="listitem">Settings from the archive builder's list of global rules.</li><li class="listitem">Default settings for each entry type (files or directories).</li></ol></div><p>
The archive builder arrives at the effective settings for each entry by:
</p><table border="0" summary="Simple list" class="simplelist"><tr><td>1.</td><td>Combine the default file or directory settings with the settings
from the first applicable global rule.</td></tr><tr><td>2.</td><td>Combine the settings created by the previous step with the settings
from the second applicable global rule.</td></tr><tr><td><div class="literallayout"><p>3 – <span class="emphasis"><em>n - 1</em></span>.</p></div></td><td>…</td></tr><tr><td><span class="emphasis"><em>n</em></span>.</td><td>Combine the settings created by the previous step with the
settings from the last applicable global rule.</td></tr><tr><td><div class="literallayout"><p><span class="emphasis"><em>n + 1</em></span>.</p></div></td><td>Combine the settings created by the previous step with
the settings from the first applicable rule for the add operation.</td></tr><tr><td><div class="literallayout"><p><span class="emphasis"><em>n + 2</em></span> – <span class="emphasis"><em>n + m - 1</em></span>.</p></div></td><td>…</td></tr><tr><td><div class="literallayout"><p><span class="emphasis"><em>n + m</em></span>.</p></div></td><td>Combine the settings created by the previous step with
the settings from the last applicable rule for the add operation.</td></tr></table><p>
When combining settings object <span class="emphasis"><em>A</em></span> with settings object
<span class="emphasis"><em>B</em></span>, a new settings object <span class="emphasis"><em>C</em></span> is created
that contains the values of properties from <span class="emphasis"><em>A</em></span>, overridden
by the values for the properties that are are set in <span class="emphasis"><em>B</em></span>.</p></div></div></div><div class="navfooter"><hr /><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="ch06.xhtml">Prev</a> </td><td align="center" width="20%"> </td><td align="right" width="40%"> <a accesskey="n" href="ch08.xhtml">Next</a></td></tr><tr><td valign="top" align="left" width="40%">Chapter 6. LZMA compression </td><td align="center" width="20%"><a accesskey="h" href="index.xhtml">Home</a></td><td valign="top" align="right" width="40%"> Chapter 8. Tar</td></tr></table></div></body></html>